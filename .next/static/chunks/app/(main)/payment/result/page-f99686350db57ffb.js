(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[22],{22628:(e,s,o)=>{"use strict";o.d(s,{default:()=>w});var n=o(95155),t=o(12115),r=o(43262),i=o(35695),a=o(81427),c=o(22661);let l=r.I4.div.withConfig({componentId:"sc-def26b87-0"})(["display:flex;flex-direction:column;align-items:center;width:100%;max-width:850px;margin:0 auto;padding:20px;"]),d=r.I4.div.withConfig({componentId:"sc-def26b87-1"})(["background-color:white;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);padding:30px;width:100%;margin-bottom:20px;"]),g=r.I4.h1.withConfig({componentId:"sc-def26b87-2"})(["font-size:24px;font-weight:600;margin-bottom:20px;color:#333;text-align:center;"]),u=r.I4.h2.withConfig({componentId:"sc-def26b87-3"})(["font-size:18px;font-weight:500;margin-bottom:16px;color:#555;text-align:center;"]),p=r.I4.div.withConfig({componentId:"sc-def26b87-4"})(["margin-top:20px;margin-bottom:30px;padding:20px;border:1px solid #e0e0e0;border-radius:8px;background-color:#f9f9f9;"]),m=r.I4.div.withConfig({componentId:"sc-def26b87-5"})(["display:flex;margin-bottom:10px;padding-bottom:10px;border-bottom:1px solid #eee;&:last-child{border-bottom:none;}"]),f=r.I4.div.withConfig({componentId:"sc-def26b87-6"})(["flex:1;font-weight:500;color:#555;"]),h=r.I4.div.withConfig({componentId:"sc-def26b87-7"})(["flex:2;color:#333;"]),x=r.I4.button.withConfig({componentId:"sc-def26b87-8"})(["background-color:#2c1810;color:white;border:none;border-radius:8px;padding:12px 24px;font-size:16px;font-weight:500;cursor:pointer;transition:background-color 0.2s;width:100%;max-width:300px;margin:0 auto;&:hover{background-color:#3a2218;}"]),I=r.I4.p.withConfig({componentId:"sc-def26b87-9"})(["color:#e53935;font-size:14px;margin:20px 0;text-align:center;"]),S=r.I4.div.withConfig({componentId:"sc-def26b87-10"})(['width:80px;height:80px;border-radius:50%;background-color:#4caf50;display:flex;align-items:center;justify-content:center;margin:0 auto 20px;&::after{content:"✓";color:white;font-size:40px;}']),b=r.I4.div.withConfig({componentId:"sc-def26b87-11"})(['width:80px;height:80px;border-radius:50%;background-color:#e53935;display:flex;align-items:center;justify-content:center;margin:0 auto 20px;&::after{content:"\xd7";color:white;font-size:40px;}']),y=r.I4.div.withConfig({componentId:"sc-def26b87-12"})(["border:4px solid rgba(0,0,0,0.1);border-left-color:#2c1810;border-radius:50%;width:36px;height:36px;animation:spin 1s linear infinite;margin:30px auto;@keyframes spin{to{transform:rotate(360deg);}}"]);function w(){let e=(0,i.useRouter)(),s=(0,i.useSearchParams)(),[o,r]=(0,t.useState)(!0),[w,j]=(0,t.useState)(null),[P,C]=(0,t.useState)(null),[_,v]=(0,t.useState)(null),[R,k]=(0,t.useState)({}),[E,A]=(0,t.useState)(!1);(0,t.useEffect)(()=>{if(console.log("Payment result page loaded"),console.log("Full URL:",window.location.href),console.log("Search params:",s.toString()),console.log("Hash:",window.location.hash),console.log("Session storage paymentSessionInfo exists:",!!sessionStorage.getItem("paymentSessionInfo")),sessionStorage.getItem("paymentSessionInfo"))try{let e=JSON.parse(sessionStorage.getItem("paymentSessionInfo")||"{}");console.log("Session info userId:",e.userId),console.log("Session info amount:",e.amount),console.log("Session info productName:",e.productName)}catch(e){console.error("Error parsing session info:",e)}},[s]),(0,t.useEffect)(()=>{let e=async()=>{try{console.log("Starting payment result processing...");let e=sessionStorage.getItem("paypleCallbackResponse"),s=sessionStorage.getItem("paymentVerificationResult"),o=sessionStorage.getItem("paymentVerificationError");if(console.log("Session storage check:",{hasCallbackResponse:!!e,hasVerificationResult:!!s,hasVerificationError:!!o}),o)try{let e=JSON.parse(o);console.log("Found verification error:",e),j(e.message||"결제 검증 중 오류가 발생했습니다."),C(e.code||"VERIFICATION_ERROR"),v({success:!1,message:e.message||"결제 검증 실패",errorCode:e.code}),r(!1);return}catch(e){console.error("Error parsing verification error:",e)}if(s)try{let e=JSON.parse(s);console.log("Found verification result:",e),v(e),r(!1);return}catch(e){console.error("Error parsing verification result:",e)}if(e){try{let s=JSON.parse(e);console.log("Found callback response, verifying:",s);let o=sessionStorage.getItem("paymentSessionInfo");if(o){let e=JSON.parse(o),n=(0,a.Qg)(c.Cn,"verifyPaymentResult"),t=await n({userId:e.userId,paymentParams:s,timestamp:Date.now()});console.log("Verification result:",t.data),v(t.data)}else throw Error("세션 정보를 찾을 수 없습니다.")}catch(e){console.error("Error verifying payment:",e),j(e instanceof Error?e.message:"결제 검증 중 오류가 발생했습니다."),v({success:!1,message:"결제 검증 실패"})}r(!1);return}let n=new URLSearchParams(window.location.search),t=n.has("PCD_PAY_RST")||n.has("success");if(console.log("URL parameters check:",{hasUrlParams:t,PCD_PAY_RST:n.get("PCD_PAY_RST"),success:n.get("success")}),t){let e=n.get("PCD_PAY_RST"),s=n.get("PCD_PAY_MSG");n.get("PCD_PAY_OID");let o={success:"success"===e,message:s||("success"===e?"결제가 완료되었습니다.":"결제가 실패했습니다."),data:Object.fromEntries(n.entries())};console.log("Processed URL result:",o),v(o),r(!1);return}let i=sessionStorage.getItem("paymentSessionInfo");if(i){console.log("Found session info, attempting manual verification...");try{let e=JSON.parse(i),s=(0,a.Qg)(c.Cn,"checkPaymentStatus"),o=await s({userId:e.userId,timestamp:e.timestamp});console.log("Manual verification result:",o.data),v(o.data)}catch(e){console.error("Manual verification failed:",e),j(e instanceof Error?e.message:"결제 상태 확인 중 오류가 발생했습니다."),v({success:!1,message:"결제 상태 확인 실패"})}}else console.log("No payment information found"),j("결제 정보를 찾을 수 없습니다."),v({success:!1,message:"결제 정보 없음"});r(!1)}catch(e){console.error("Error processing payment result:",e),j(e instanceof Error?e.message:"결제 결과 처리 중 오류가 발생했습니다."),v({success:!1,message:"처리 오류"}),r(!1)}};k({url:window.location.href,searchParams:s.toString(),sessionStorage:{paymentSessionInfo:sessionStorage.getItem("paymentSessionInfo"),paypleCallbackResponse:sessionStorage.getItem("paypleCallbackResponse"),paymentVerificationResult:sessionStorage.getItem("paymentVerificationResult"),paymentVerificationError:sessionStorage.getItem("paymentVerificationError")},timestamp:new Date().toISOString()}),e()},[s]);let D=()=>{e.push("/")};return o?(0,n.jsx)(l,{children:(0,n.jsxs)(d,{children:[(0,n.jsx)(y,{}),(0,n.jsx)(u,{children:"결제 결과를 확인하고 있습니다..."})]})}):(0,n.jsx)(l,{children:(0,n.jsxs)(d,{children:[(null==_?void 0:_.success)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(S,{}),(0,n.jsx)(g,{children:"결제 완료!"}),(0,n.jsx)(u,{children:_.message}),_.data&&(0,n.jsxs)(p,{children:[(0,n.jsxs)(m,{children:[(0,n.jsx)(f,{children:"주문번호:"}),(0,n.jsx)(h,{children:_.data.PCD_PAY_OID||"N/A"})]}),(0,n.jsxs)(m,{children:[(0,n.jsx)(f,{children:"결제수단:"}),(0,n.jsx)(h,{children:_.data.PCD_PAY_TYPE||"N/A"})]}),(0,n.jsxs)(m,{children:[(0,n.jsx)(f,{children:"결제자 ID:"}),(0,n.jsx)(h,{children:_.data.PCD_PAYER_ID||"N/A"})]}),(0,n.jsxs)(m,{children:[(0,n.jsx)(f,{children:"결제 상태:"}),(0,n.jsx)(h,{children:_.data.PCD_PAY_RST||"success"})]})]}),(0,n.jsx)(x,{onClick:D,children:"메인으로 돌아가기"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(b,{}),(0,n.jsx)(g,{children:"결제 실패"}),(0,n.jsx)(u,{children:(null==_?void 0:_.message)||w||"결제 처리 중 오류가 발생했습니다."}),P&&(0,n.jsxs)(I,{children:["오류 코드: ",P]}),(null==_?void 0:_.data)&&(0,n.jsxs)(p,{children:[(0,n.jsxs)(m,{children:[(0,n.jsx)(f,{children:"오류 메시지:"}),(0,n.jsx)(h,{children:_.data.PCD_PAY_MSG||"N/A"})]}),(0,n.jsxs)(m,{children:[(0,n.jsx)(f,{children:"주문번호:"}),(0,n.jsx)(h,{children:_.data.PCD_PAY_OID||"N/A"})]}),(0,n.jsxs)(m,{children:[(0,n.jsx)(f,{children:"결제 상태:"}),(0,n.jsx)(h,{children:_.data.PCD_PAY_RST||"failed"})]})]}),(0,n.jsx)(x,{onClick:()=>{e.push("/payment")},style:{marginBottom:"10px"},children:"다시 시도하기"}),(0,n.jsx)(x,{onClick:D,style:{backgroundColor:"#666"},children:"메인으로 돌아가기"})]}),!1]})})}},22661:(e,s,o)=>{"use strict";o.d(s,{Cn:()=>u,IG:()=>g,db:()=>d,j2:()=>l});var n=o(23915),t=o(16203),r=o(35317),i=o(90858),a=o(81427);let c=(0,n.Wp)({apiKey:"AIzaSyBC62vsKGQqdgpyC9RugoHEfh9UcRi2SMA",authDomain:"one-cup-eng.firebaseapp.com",projectId:"one-cup-eng",storageBucket:"one-cup-eng.firebasestorage.app",messagingSenderId:"615807178262",appId:"1:615807178262:web:9a96a5f0d94ae628d74737"}),l=(0,t.xI)(c),d=(0,r.aU)(c),g=(0,i.c7)(c),u=(0,a.Uz)(c,"asia-northeast3")},35695:(e,s,o)=>{"use strict";var n=o(18999);o.o(n,"useParams")&&o.d(s,{useParams:function(){return n.useParams}}),o.o(n,"usePathname")&&o.d(s,{usePathname:function(){return n.usePathname}}),o.o(n,"useRouter")&&o.d(s,{useRouter:function(){return n.useRouter}}),o.o(n,"useSearchParams")&&o.d(s,{useSearchParams:function(){return n.useSearchParams}}),o.o(n,"useServerInsertedHTML")&&o.d(s,{useServerInsertedHTML:function(){return n.useServerInsertedHTML}})},92903:(e,s,o)=>{Promise.resolve().then(o.bind(o,22628))}},e=>{var s=s=>e(e.s=s);e.O(0,[992,888,262,432,441,684,358],()=>s(92903)),_N_E=e.O()}]);