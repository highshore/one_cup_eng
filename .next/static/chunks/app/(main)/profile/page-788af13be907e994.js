(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[897],{22661:(e,t,o)=>{"use strict";o.d(t,{Cn:()=>h,IG:()=>p,db:()=>d,j2:()=>l});var i=o(23915),n=o(16203),r=o(35317),a=o(90858),c=o(81427);let s=(0,i.Wp)({apiKey:"AIzaSyBC62vsKGQqdgpyC9RugoHEfh9UcRi2SMA",authDomain:"one-cup-eng.firebaseapp.com",projectId:"one-cup-eng",storageBucket:"one-cup-eng.firebasestorage.app",messagingSenderId:"615807178262",appId:"1:615807178262:web:9a96a5f0d94ae628d74737"}),l=(0,n.xI)(s),d=(0,r.aU)(s),p=(0,a.c7)(s),h=(0,c.Uz)(s,"asia-northeast3")},35192:(e,t,o)=>{Promise.resolve().then(o.bind(o,68565))},68565:(e,t,o)=>{"use strict";o.d(t,{default:()=>$});var i=o(95155),n=o(43262),r=o(22661),a=o(12115),c=o(90858),s=o(16203),l=o(35695),d=o(35317),p=o(94008),h=o(20480),u=o(81427);let f=n.I4.div.withConfig({componentId:"sc-c1c2a66f-0"})(["display:flex;flex-direction:column;align-items:center;width:100%;gap:10px;padding:20px 0px;max-width:920px;margin:0 auto;"]),g=n.I4.div.withConfig({componentId:"sc-c1c2a66f-1"})(["background-color:transparent;border:1px solid #ddd;border-radius:20px;padding:20px;width:100%;margin-bottom:20px;font-family:inherit;"]),x=n.I4.div.withConfig({componentId:"sc-c1c2a66f-2"})(["background-color:transparent;border-radius:8px;padding:20px;width:100%;box-shadow:0 2px 8px rgba(0,0,0,0.1);margin-bottom:20px;font-family:inherit;"]),m=(0,n.I4)(g).withConfig({componentId:"sc-c1c2a66f-3"})(["display:flex;flex-direction:column;width:100%;"]),b=n.I4.div.withConfig({componentId:"sc-c1c2a66f-4"})(["display:flex;justify-content:space-between;width:100%;"]),w=n.I4.div.withConfig({componentId:"sc-c1c2a66f-5"})(["flex:1;"]),v=n.I4.div.withConfig({componentId:"sc-c1c2a66f-6"})(["display:flex;flex-direction:column;align-items:center;justify-content:center;padding-left:20px;"]),y=n.I4.div.withConfig({componentId:"sc-c1c2a66f-7"})(["display:flex;gap:10px;margin-top:8px;"]),j=n.I4.div.withConfig({componentId:"sc-c1c2a66f-8"})(["font-size:12px;color:#777;cursor:pointer;transition:color 0.2s;&:hover{color:#2c1810;text-decoration:underline;}"]),I=n.I4.span.withConfig({componentId:"sc-c1c2a66f-9"})(["font-size:0.9rem;color:#666;margin-bottom:0.25rem;width:80px;display:inline-block;text-align:left;"]),C=n.I4.span.withConfig({componentId:"sc-c1c2a66f-10"})(["font-size:0.9rem;font-weight:500;margin-bottom:0.5rem;font-family:inherit;"]),k=n.I4.div.withConfig({componentId:"sc-c1c2a66f-11"})(["display:flex;align-items:center;margin-bottom:12px;font-size:16px;"]),D=n.I4.h3.withConfig({componentId:"sc-c1c2a66f-12"})(["font-size:18px;font-weight:600;margin-bottom:20px;color:#333;border-bottom:1px solid #ddd;padding-bottom:15px;width:100%;display:flex;align-items:center;justify-content:space-between;"]),P=n.I4.div.withConfig({componentId:"sc-c1c2a66f-13"})(["padding-top:10px;width:100%;"]),_=n.I4.label.withConfig({componentId:"sc-c1c2a66f-14"})(['width:80px;height:80px;overflow:hidden;border-radius:50%;background-color:#000;cursor:pointer;display:flex;align-items:center;justify-content:center;position:relative;&:hover::after{content:"변경";position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,0.5);color:white;font-size:12px;text-align:center;padding:4px 0;}svg{width:50px;}']),S=n.I4.img.withConfig({componentId:"sc-c1c2a66f-15"})(["width:100%;height:100%;object-fit:cover;"]),U=n.I4.input.withConfig({componentId:"sc-c1c2a66f-16"})(["display:none;"]),E=n.I4.input.withConfig({componentId:"sc-c1c2a66f-17"})(["font-size:16px;font-weight:500;padding:6px 10px;border:1px solid #ccc;border-radius:4px;background-color:white;width:200px;outline:none;&:focus{border-color:#4caf50;box-shadow:0 0 0 2px rgba(76,175,80,0.2);}"]),R=n.I4.div.withConfig({componentId:"sc-c1c2a66f-18"})(["position:relative;display:flex;align-items:center;"]),z=n.I4.span.withConfig({componentId:"sc-c1c2a66f-19"})(["position:absolute;right:10px;color:#4caf50;font-size:18px;cursor:pointer;"]),L=n.I4.span.withConfig({shouldForwardProp:e=>"active"!==e}).withConfig({componentId:"sc-c1c2a66f-20"})(["display:inline-block;background-color:",";color:white;padding:0.5rem 1rem;border-radius:20px;font-size:1rem;font-weight:600;margin-left:10px;"],e=>e.active?"#00a000":"#808080"),A=n.I4.button.withConfig({componentId:"sc-c1c2a66f-21"})(["background-color:#2c1810;color:white;font-weight:600;padding:0.875rem 1.5rem;border:none;border-radius:20px;font-size:1rem;cursor:pointer;transition:all 0.2s;box-shadow:0 2px 4px rgba(0,0,0,0.1);&:hover{background-color:#3a66e5;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.15);}&:disabled{background-color:#a0b0e0;cursor:not-allowed;transform:none;box-shadow:none;}"]),F=(0,n.I4)(A).withConfig({componentId:"sc-c1c2a66f-22"})(["background-color:#e74c3c;&:hover{background-color:#c0392b;}"]),K=n.I4.div.withConfig({componentId:"sc-c1c2a66f-23"})(["position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:1000;"]),B=n.I4.div.withConfig({componentId:"sc-c1c2a66f-24"})(["background-color:white;padding:2rem;border-radius:8px;max-width:500px;width:90%;"]),M=n.I4.div.withConfig({componentId:"sc-c1c2a66f-25"})(["display:flex;gap:1rem;margin-top:1.5rem;justify-content:flex-end;"]),N=(0,n.I4)(A).withConfig({componentId:"sc-c1c2a66f-26"})(["background-color:#757575;&:hover{background-color:#616161;}"]),G=n.I4.button.withConfig({componentId:"sc-c1c2a66f-27"})(["background-color:#d73a49;color:white;padding:8px 16px;border:none;border-radius:20px;cursor:pointer;font-size:14px;margin-top:10px;width:auto;transition:all 0.2s;box-shadow:0 2px 4px rgba(0,0,0,0.1);&:hover{background-color:#c92532;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.15);}"]),H=n.I4.div.withConfig({componentId:"sc-c1c2a66f-28"})(["margin:-10px 0;max-height:300px;overflow-y:auto;display:grid;grid-template-columns:1fr;gap:8px;scrollbar-width:thin;scrollbar-color:rgba(44,24,16,0.5) transparent;&::-webkit-scrollbar{width:6px;}&::-webkit-scrollbar-track{background:transparent;}&::-webkit-scrollbar-thumb{background-color:rgba(44,24,16,0.3);border-radius:6px;}"]),Y=n.I4.div.withConfig({componentId:"sc-c1c2a66f-29"})(["padding:12px;border-radius:6px;background-color:transparent;border:1px solid #eee;transition:all 0.2s ease;display:flex;flex-direction:column;cursor:pointer;&:hover{transform:translateY(-2px);box-shadow:0 2px 8px rgba(0,0,0,0.05);}"]),q=n.I4.div.withConfig({componentId:"sc-c1c2a66f-30"})(["font-size:16px;font-weight:500;color:#333;margin-bottom:5px;"]),O=n.I4.div.withConfig({componentId:"sc-c1c2a66f-31"})(["font-size:12px;color:#777;"]),Q=n.I4.div.withConfig({componentId:"sc-c1c2a66f-32"})(["padding:8px 12px;margin:6px 0;border-radius:4px;background-color:white;display:flex;justify-content:space-between;align-items:center;transition:all 0.2s ease;&:hover{transform:translateY(-2px);box-shadow:0 2px 5px rgba(0,0,0,0.05);}"]),T=n.I4.div.withConfig({componentId:"sc-c1c2a66f-33"})(["max-height:200px;overflow-y:auto;margin-top:15px;"]),W=(0,n.I4)(x).withConfig({shouldForwardProp:e=>"type"!==e}).withConfig({componentId:"sc-c1c2a66f-34"})(["background-color:",";margin-bottom:1rem;border-radius:20px;p{color:",";}"],e=>"success"===e.type?"#e8f5e9":"#ffebee",e=>"success"===e.type?"#2e7d32":"#c62828"),X=(0,n.I4)(g).withConfig({componentId:"sc-c1c2a66f-35"})([""]),Z=(0,n.I4)(A).withConfig({componentId:"sc-c1c2a66f-36"})(["background-color:#2c1810;width:100%;&:hover{background-color:#4a2d1d;}"]),J=n.I4.button.withConfig({componentId:"sc-c1c2a66f-37"})(["background-color:transparent;color:#808080;padding:0.5rem;border:none;border-radius:4px;font-size:0.8rem;font-weight:500;cursor:pointer;text-decoration:none;transition:all 0.2s;&:hover{color:#c0392b;text-decoration:underline;}&:disabled{color:#bdbdbd;cursor:not-allowed;text-decoration:none;}"]),V="/default_user.jpg";function $(){let e=r.j2.currentUser,[t,o]=(0,a.useState)((null==e?void 0:e.photoURL)||""),[n,x]=(0,a.useState)(""),[A,$]=(0,a.useState)(null),ee=(0,l.useRouter)(),[et,eo]=(0,a.useState)(null),[ei,en]=(0,a.useState)(!0),[er,ea]=(0,a.useState)([]),[ec,es]=(0,a.useState)(!1),[el,ed]=(0,a.useState)((null==e?void 0:e.displayName)||""),[ep,eh]=(0,a.useState)(!1),[eu,ef]=(0,a.useState)(!1),[eg,ex]=(0,a.useState)({status:"unknown"}),[em,eb]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let t=async e=>{try{let n=[];for(let a of e){let e=await (0,d.x7)((0,d.H9)(r.db,"articles",a));if(e.exists()){var t,o,i;let r=e.data();n.push({id:a,title:(null==(t=r.title)?void 0:t.english)||(null==(o=r.title)?void 0:o.korean)||"Untitled",date:(null==(i=r.timestamp)?void 0:i.toDate())||null})}else n.push({id:a})}ea(n)}catch(e){console.error("Error fetching article titles:",e)}};(async()=>{if(!e)return ee.push("/auth");try{if(en(!0),e.photoURL){console.log("Profile - Found photoURL:",e.photoURL);try{let t=new URL(e.photoURL);t.searchParams.set("t",Date.now().toString()),o(t.toString())}catch(t){console.log("Profile - Invalid URL format:",e.photoURL,t),o(e.photoURL)}}else console.log("Profile - No photoURL found for user"),o("");let s=(0,d.H9)(r.db,"users/".concat(e.uid)),l=await (0,d.x7)(s);if(l.exists()){var i,n,a,c;let e=l.data(),o={cat_business:e.cat_business||!1,cat_tech:e.cat_tech||!1,last_received:(null==(i=e.last_received)?void 0:i.toDate())||new Date(0),received_articles:e.received_articles||[],saved_words:e.saved_words||[],createdAt:(null==(n=e.createdAt)?void 0:n.toDate())||new Date,hasActiveSubscription:e.hasActiveSubscription||!1,subscriptionStartDate:null==(a=e.subscriptionStartDate)?void 0:a.toDate(),subscriptionEndDate:null==(c=e.subscriptionEndDate)?void 0:c.toDate(),billingKey:e.billingKey,paymentMethod:e.paymentMethod};eo(o);let r={status:o.hasActiveSubscription?"active":"canceled",startDate:o.subscriptionStartDate,cancelledDate:o.subscriptionEndDate,paymentMethod:o.paymentMethod||"카드",billingKey:o.billingKey};if(r.startDate&&"active"===r.status){let e=new Date(r.startDate);e.setMonth(e.getMonth()+1),r.nextBillingDate=e}if(ex(r),e.received_articles&&e.received_articles.length>0){let o=e.received_articles.slice(-10);await t(o)}}else x("페이지를 새로고침해주세요!")}catch(e){console.error("Error fetching user data:",e),x("Failed to load user data.")}finally{en(!1)}})()},[e,ee]);let ew=async t=>{let{files:i}=t.target;if(!e)return void x("Please log in again to upload avatar");if(i&&1===i.length){let n=i[0];if(n.size>2097152){x("File too large. Please select an image under 2MB"),t.target.value="";return}try{x(""),$(null),eb(!0);let i=(0,c.KR)(r.IG,"avatars/user_".concat(e.uid)),a=await (0,c.D)(i,n),l=await (0,c.qk)(a.ref);console.log("Profile - Uploaded new avatar:",l),await (0,s.r7)(e,{photoURL:l}),console.log("Profile - Updated user profile with new photoURL");let d=new URL(l);d.searchParams.set("t",Date.now().toString()),o(d.toString()),$("Profile picture updated successfully!"),t.target.value=""}catch(e){console.error("Profile - Error uploading avatar:",e),x("Failed to upload image. Please try again."),t.target.value=""}finally{eb(!1)}}},ev=async()=>{if(e&&t)try{x(""),$(null),eb(!0);let t=(0,c.KR)(r.IG,"avatars/user_".concat(e.uid));await (0,c.XR)(t),console.log("Profile - Deleted avatar from storage"),await (0,s.r7)(e,{photoURL:""}),console.log("Profile - Updated user profile to remove photoURL"),o(""),$("Profile picture deleted successfully!")}catch(t){if(console.error("Profile - Error deleting avatar:",t),t instanceof Error&&t.message.includes("object-not-found"))try{await (0,s.r7)(e,{photoURL:""}),o(""),$("Profile picture removed successfully!")}catch(e){console.error("Profile - Error updating profile after delete:",e),x("Failed to remove profile picture. Please try again.")}else x("Failed to delete profile picture. Please try again.")}finally{eb(!1)}},ey=async()=>{try{await (0,s.CI)(r.j2),console.log("User signed out successfully"),ee.push("/")}catch(e){console.error("Error signing out:",e),x("Failed to sign out. Please try again.")}},ej=e=>{ee.push("/blog/".concat(e))},eI=async()=>{if(e)try{await (0,s.r7)(e,{displayName:el}),es(!1),$("Display name updated successfully!")}catch(e){console.error("Error updating display name:",e),x("Failed to update display name. Please try again.")}},eC=async()=>{if(!e||!eg.billingKey)return void x("구독 정보를 찾을 수 없습니다.");ef(!0),x("");try{let o=(0,u.Qg)(r.Cn,"cancelSubscription"),i=await o({userId:e.uid,billingKey:eg.billingKey});if(console.log("Subscription cancellation result:",i.data),i.data&&i.data.success){ex(e=>({...e,status:"canceled",cancelledDate:new Date}));let t=(0,d.H9)(r.db,"users",e.uid);await (0,d.mZ)(t,{hasActiveSubscription:!1,subscriptionEndDate:new Date}),$("구독이 성공적으로 해지되었습니다."),eh(!1)}else{var t;throw Error((null==(t=i.data)?void 0:t.message)||"구독 해지에 실패했습니다.")}}catch(e){console.error("Error canceling subscription:",e),x(e instanceof Error?e.message:"구독 해지 중 오류가 발생했습니다. 고객 서비스에 문의해주세요.")}finally{ef(!1)}},ek=e=>e?(0,p.GP)(e,"yyyy년 MM월 dd일",{locale:h.ko}):"-";return ei?(0,i.jsx)(f,{children:"Loading user data..."}):(0,i.jsxs)(f,{children:[n&&(0,i.jsx)(W,{type:"error",children:(0,i.jsx)("p",{children:n})}),A&&(0,i.jsx)(W,{type:"success",children:(0,i.jsx)("p",{children:A})}),em&&(0,i.jsx)("div",{style:{textAlign:"center",marginBottom:"15px"},children:"Uploading image... Please wait."}),(0,i.jsxs)(m,{children:[(0,i.jsx)(D,{children:"기본 정보"}),(0,i.jsx)(P,{children:(0,i.jsxs)(b,{children:[(0,i.jsxs)(w,{children:[(0,i.jsxs)(k,{children:[(0,i.jsx)(I,{children:"유저명"}),ec?(0,i.jsxs)(R,{children:[(0,i.jsx)(E,{type:"text",value:el,onChange:e=>{ed(e.target.value)},placeholder:"이름 입력",autoFocus:!0,onKeyPress:e=>{"Enter"===e.key&&eI()}}),(0,i.jsx)(z,{onClick:eI,children:"✓"})]}):(0,i.jsx)(C,{onClick:()=>es(!0),children:(null==e?void 0:e.displayName)?e.displayName:"유저명을 정해주세요"})]}),(0,i.jsxs)(k,{children:[(0,i.jsx)(I,{children:"휴대폰"}),(0,i.jsx)(C,{children:(null==e?void 0:e.phoneNumber)||"번호 없음"})]}),(0,i.jsxs)(k,{children:[(0,i.jsx)(I,{children:"가입일"}),(0,i.jsx)(C,{children:(null==et?void 0:et.createdAt)?ek(et.createdAt):"-"})]})]}),(0,i.jsxs)(v,{children:[(0,i.jsx)(_,{htmlFor:"avatar",children:t?(0,i.jsx)(S,{src:t,alt:"Profile",onError:e=>{let t=e.target;t.onerror=null,t.src=V,console.log("Profile - Image failed to load, using default")}}):(0,i.jsx)("img",{src:V,alt:"Default Profile",style:{width:"100%",height:"100%",objectFit:"cover"}})}),(0,i.jsxs)(y,{children:[(0,i.jsx)(j,{onClick:()=>{var e;return null==(e=document.getElementById("avatar"))?void 0:e.click()},children:"변경"}),t&&(0,i.jsx)(j,{onClick:ev,children:"삭제"})]}),(0,i.jsx)(U,{onChange:ew,id:"avatar",type:"file",accept:"image/*"})]})]})})]}),(0,i.jsxs)(X,{children:[(0,i.jsxs)(D,{children:["구독 정보",(0,i.jsx)(L,{active:"active"===eg.status,children:"active"===eg.status?"상태: 이용 중":"상태: 비활성화"})]}),(0,i.jsxs)(P,{children:[(0,i.jsxs)(k,{children:[(0,i.jsx)(I,{children:"카테고리"}),(0,i.jsx)(C,{children:(null==et?void 0:et.cat_business)||(null==et?void 0:et.cat_tech)?"".concat((null==et?void 0:et.cat_business)?"Business":"").concat((null==et?void 0:et.cat_business)&&(null==et?void 0:et.cat_tech)?", ":"").concat((null==et?void 0:et.cat_tech)?"Tech":""):"선택 없음"})]}),(0,i.jsxs)(k,{children:[(0,i.jsx)(I,{children:"최근 결제일"}),(0,i.jsx)(C,{children:ek(eg.startDate)})]}),(0,i.jsxs)(k,{children:[(0,i.jsx)(I,{children:"다음 결제일"}),(0,i.jsx)(C,{children:"active"===eg.status?ek(eg.nextBillingDate):"-"})]}),(0,i.jsxs)("div",{style:{marginTop:"1.5rem",display:"flex",justifyContent:"flex-end"},children:["active"===eg.status&&(0,i.jsx)(J,{onClick:()=>eh(!0),children:"멤버십 해지하기"}),"canceled"===eg.status&&(0,i.jsx)(Z,{onClick:()=>ee.push("/payment"),children:"멤버십 시작하기"})]})]})]}),(0,i.jsxs)(g,{children:[(0,i.jsx)(D,{children:"영어 한잔 기록"}),(0,i.jsx)(P,{children:(0,i.jsx)(H,{children:er.length>0?[...er].reverse().map(e=>(0,i.jsxs)(Y,{onClick:()=>ej(e.id),children:[(0,i.jsx)(q,{children:e.title||"Article ".concat(e.id)}),(0,i.jsx)(O,{children:e.date?ek(e.date):"날짜 정보 없음"})]},e.id)):(0,i.jsx)("div",{style:{padding:"1rem",textAlign:"center",color:"#888"},children:"아직 받은 아티클이 없습니다"})})})]}),(null==et?void 0:et.saved_words)&&et.saved_words.length>0&&(0,i.jsxs)(g,{children:[(0,i.jsx)(D,{children:"저장한 단어"}),(0,i.jsx)(P,{children:(0,i.jsx)(T,{children:et.saved_words.map((e,t)=>(0,i.jsx)(Q,{children:(0,i.jsx)("span",{children:e})},t))})})]}),(0,i.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",width:"100%"},children:(0,i.jsx)(G,{onClick:ey,children:"로그아웃"})}),ep&&(0,i.jsx)(K,{children:(0,i.jsxs)(B,{children:[(0,i.jsx)(D,{children:"구독 해지"}),(0,i.jsx)("p",{style:{marginBottom:"1rem"},children:"정말로 구독을 해지하시겠습니까?"}),(0,i.jsx)("p",{style:{marginBottom:"1rem"},children:"해지 시 즉시 서비스 이용이 중단되며, 이미 결제된 금액은 환불되지 않습니다."}),(0,i.jsxs)(M,{children:[(0,i.jsx)(N,{onClick:()=>eh(!1),disabled:eu,children:"취소"}),(0,i.jsx)(F,{onClick:eC,disabled:eu,children:eu?"처리 중...":"해지하기"})]})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[992,888,262,432,803,441,684,358],()=>t(35192)),_N_E=e.O()}]);